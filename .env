
###############################################################################
#                               MINIO (S3) CORE                               #
###############################################################################
# Логин/пароль «суперпользователя» MinIO. Используются ТОЛЬКО контейнером minio.
# НИКОГДА не reuse эти значения как доступ из WebSoft.
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=E3L8jN4uQkC7pT0mZx1R9wV6sB5aH2yP1

# URL S3‑эндпоинта MinIO. Используется WebSoft (VFS) и любыми внешними клиентами.
# Формат: https://<host>:<port>. Для dev — чаще всего https://minio.local:9000
S3_SERVICE_URL=https://minio:9000

# Аккаунт S3/MinIO, под которым WebSoft будет читать/писать в бакеты.
# Это НЕ root, а сервисный пользователь с минимальными правами (политики на нужные бакеты).
S3_ACCESS_KEY_ID=wt-s3
S3_SECRET_ACCESS_KEY=E3L8jN4uQkC7pT0mZx1R9wV6sB5aH2yP

# read-only пользователь для чтения бакета logs
S3_LOGS_RO_ACCESS_KEY_ID=wt-logs-ro
S3_LOGS_RO_SECRET_ACCESS_KEY=E3L8jN4uQkC7pT0mZx1R9wV6sB5aH2yP2

# Режим адресации бакетов. Для MinIO должен быть TRUE (path-style: https://minio/bucket/obj).
# Для AWS S3 можно переключить на false (virtual-host style), если потребуется.
S3_FORCE_PATH_STYLE=true

# Таймаут S3-запросов WebSoft (в секундах). В «шумных» сетях иногда повышают до 120.
S3_TIMEOUT=60

# (Опционально) Путь внутри контейнеров WT к корневому сертификату MinIO (если самоподпись/mkcert).
# По умолчанию скрипт ищет /WebsoftServer/certs/minio-rootCA.pem — не меняйте, если путь совпадает.
S3_TRUSTED_CA_PATH=/WebsoftServer/certs/minio/minio-rootCA.pem

###############################################################################
#                                VFS (S3) BUCKETS                             #
###############################################################################
# Именование бакетов, где WebSoft будет хранить данные через VFS:
# - WEBTUTOR        : «медиа-контент» платформы (web/webtutor)
# - SPXML_BLOBS     : вложения/бинарные данные (wt_data)
# - APPLICATIONS    : пакеты приложений/плагинов (applications)
# - FTIDX           : индекс полнотекстового поиска Lucene — общий, если выбран S3-вариант (ft-idx)
# - LOGS            : логи платформы; разнос по нодам делаем префиксами Location (Logs)
BUCKET_WEBTUTOR=webtutor
BUCKET_SPXML_BLOBS=spxml-blobs
BUCKET_APPLICATIONS=applications
BUCKET_FTIDX=ft-idx
BUCKET_RECORDS=records
BUCKET_LOGS=logs


###############################################################################
#                         LOGS: ПРЕФИКСЫ ДЛЯ КАЖДОЙ РОЛИ                      #
###############################################################################
# Префиксы (псевдо‑папки) внутри бакета LOGS. Важно завершать «/».
# Рекомендуется синхронизировать именование с названиями сервисов в docker-compose.
LOG_LOCATION_WEB1=web-backend-1/
LOG_LOCATION_WEB2=web-backend-2/
LOG_LOCATION_WORKER=worker-backend/
LOG_LOCATION_VCLASS=vclass-media/
LOG_LOCATION_RECORDER=vclass-recorder/
LOG_LOCATION_WEB_INIT=web-backend-init/


###############################################################################
#                      LOGS: ПАРАМЕТРЫ «СХЛОПЫВАНИЯ» ФАЙЛОВ                   #
###############################################################################
# Как часто забирать накопленные сообщения и формировать файлы логов (сек).
LOG_MIN_CHECK_INTERVAL=5

# Включить консолидацию мелких файлов логов в более крупные (true/false).
LOG_CONSOLIDATION=true

# Периодичность фона консолидации (сек).
LOG_CONSOLIDATE_CHECK_INTERVAL=60

# Полная консолидация (агрессивнее объединяет куски) (true/false).
LOG_FULL_CONSOLIDATION=true


###############################################################################
#                    VFS: ПОВЕДЕНИЕ «ПАССИВНОЙ МИГРАЦИИ» ДАННЫХ               #
###############################################################################
# Если объект не найден в VFS (S3), искать ли его в «классическом» месте (диск/БД).
VFS_LOOK_ON_LOCAL=true

# Если нашли локально — «подложить» обратно в VFS (загрузить на S3).
VFS_FETCH_BACK=true

# После успешной подгрузки в VFS удалять локальную копию (делает постепенную очистку wt_data).
# На старте миграции лучше false; после проверки — можно переключить на true.
VFS_DELETE_LOCAL_AFTER_FETCH=false


###############################################################################
#                           ПОВЕДЕНИЕ ПУБЛИКАЦИИ МЕДИА                        #
###############################################################################
# Делать ли контент «публичным» через reverse-proxy/статическую раздачу.
# Обычно false: доступ управляется правами в WebSoft и/или presigned URL (если внедрять).
BUCKET_WEBTUTOR_PUBLIC=false

###############################################################################
#                          MONITORING / logstash → loki                       #
###############################################################################
# Куда слать логи (URL Loki)
LOKI_SERVICE_URL=http://loki:3100

# Имя job-лейбла в Loki (для удобства фильтрации в Grafana)
LOKI_JOB_LABEL=websoft-hcm

# Фолбэки, если не удаётся распарсить из имени файла
ROLE_FALLBACK=role_not_found
ENV_FALLBACK=env_not_found
LOG_TYPE_FALLBACK=log_type_not_found
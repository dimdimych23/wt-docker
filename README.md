# WebSoft HCM (WebTutor) ‚Äî –∫–ª–∞—Å—Ç–µ—Ä–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ Docker

–≠—Ç–æ—Ç README –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ WebSoft HCM (WebTutor) –≤ –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Docker.

---

## ‚ú® –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

- `PostgreSQL` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- `Redis` ‚Äî –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–ª–∞—Å—Ç–µ—Ä—ã
- `WebSoft HCM`:
  - 2 –Ω–æ–¥—ã WebRole (`web1`, `web2`)
  - 1 –Ω–æ–¥–∞ WorkerRole (`worker`)
  - 1 –Ω–æ–¥–∞ MediaService (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–∏–∑—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç)
  - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–æ–ª–∏ WebRole –≤–æ–∑–º–æ–∂–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `web3`)
- `Nginx` ‚Äî –≤–Ω–µ—à–Ω–∏–π –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ (–Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω –Ω–∞ —ç—Ç–∞–ø–µ dev)
- `Grafana + Loki + Promtail` ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## ‚úÖ –≠—Ç–∞–ø 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–î–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –∏ —Å—Ö–µ–º ‚Äî –∑–∞–ø—É—Å–∫–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω—É—é init-–Ω–æ–¥—É.

### ‚ö° –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ `docker-compose.init.yml`

```bash
docker compose -f docker-compose.init.yml up -d
```

> **–í–∞–∂–Ω–æ:** init-–Ω–æ–¥–∞ –∏–º–µ–µ—Ç `UpgradeLocked: false` –∏ `StrictWebRole: false`. –û–Ω–∞ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ë–î.

### ‚ùå –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
docker compose -f docker-compose.init.yml down
```

---

## ‚úÖ –≠—Ç–∞–ø 2: –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞

–ü–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Äî –∑–∞–ø—É—Å–∫–∞–µ–º –±–æ–µ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã:

```bash
docker compose up -d
```

### üíº –ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–æ–ª—è–º

- Web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å WebTutor: http://localhost:81
- –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ Worker (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è): http://localhost:82

Nginx –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –º–µ–∂–¥—É web1, web2 –∏ worker –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ—Ä—Ç–∞.

### ‚ÑπÔ∏è –ß—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ `docker-compose.yml`

- `postgres` ‚Äî —Å `init.sql` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ë–î `wt`
- `redis` ‚Äî —Å healthcheck –∏ volume
- `pgadmin` ‚Äî –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ë–î
- `web1`, `web2`, `worker` ‚Äî —Ä–æ–ª–∏ WebTutor:
  - `RoleType=0` ‚Äî WebRole
  - `RoleType=1` ‚Äî WorkerRole
  - `StrictWebRole` –∏ `StrictWorkerRole` —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ `spxml_unibridge_config.xml`
- `volumes:` –∏ `networks:` ‚Äî –æ–±—â–∏–µ: `wt_net`, `pgdata`, `redis_data`, `grafana-storage` –∏ —Ç.–¥.

---

## üí° –í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### `xHttp.ini`

–û–±—â–∏–π –¥–ª—è –≤—Å–µ—Ö –Ω–æ–¥:

- `DEFAULT-DATABASE: wt_data`
- `WEB-DIR: wt/web`
- `DOTNETCORE-PATH`, `DOTNETLIBS-PATH` ‚Äî –≤–∞–∂–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã C# –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### `spxml_unibridge_config.xml`

–†–∞–∑–Ω—ã–π –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–æ–ª–∏:

–ü—Ä–∏–º–µ—Ä—ã –∫–ª—é—á–µ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:

```xml
<add key="Cluster" value="true" />
<add key="StrictWebRole" value="true" />
<add key="StrictWorkerRole" value="false" />
<add key="DistributedCache" value="true" />
<add key="DistributedCacheType" value="spxml_redis_cache" />
<add key="DistributedCacheConfig" value="redis:6379, abortConnect=false, ..." />
```

> **–í–∞–∂–Ω–æ:** –¢–æ–ª—å–∫–æ –æ–¥–Ω–∞ –Ω–æ–¥–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è —Å `UpgradeLocked: false` (—ç—Ç–æ –±—ã–ª–∞ init-–Ω–æ–¥–∞)

### `nginx.conf`

–ù–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `./nginx/nginx.conf`. –°–æ–¥–µ—Ä–∂–∏—Ç:

- –ü—Ä–æ–∫—Å–∏ –¥–ª—è WebRole (–ø–æ—Ä—Ç 81) ‚Äî upstream `wt_web1` –∏ `wt_web2`
- –ü—Ä–æ–∫—Å–∏ –¥–ª—è WorkerRole (–ø–æ—Ä—Ç 82) ‚Äî –ø—Ä—è–º–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ `wt_worker`

–£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–∫–∏ `Host`, `X-Real-IP`, `X-Forwarded-For`, `X-Forwarded-Proto`.

---

## üîé –õ–æ–≥–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–õ–æ–≥–∏ –∫–∞–∂–¥–æ–π —Ä–æ–ª–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –ø–æ –ø—É—Ç—è–º:

```
/WebsoftServer/Logs/web1
/WebsoftServer/Logs/web2
/WebsoftServer/Logs/worker
/WebsoftServer/Logs/mediaserver
```

### –ï—Å–ª–∏ –ø–æ–¥–∫–ª—é—á—ë–Ω Loki + Promtail + Grafana:
- –í `promtail.yaml` —É–∫–∞–∑–∞–Ω—ã –ø—É—Ç–∏ –∫ —ç—Ç–∏–º –ª–æ–≥–∞–º
- Grafana –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–∞ `http://localhost:3000`

---

## üîê –ü—Ä–∞–≤–∞ –∏ –ª–∏—Ü–µ–Ω–∑–∏–∏

–í `license.xfpx` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∏–º—è —Ö–æ—Å—Ç–∞:

```yaml
hostname: wt_dev
```

–í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π `hostname`, —á—Ç–æ–±—ã –ª–∏—Ü–µ–Ω–∑–∏—è –ø—Ä–∏–º–µ–Ω—è–ª–∞—Å—å.

---

## ‚öñÔ∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- –ù–µ –∑–∞–ø—É—Å–∫–∞–π WebRole –∏ Worker –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å—Ç–∞—Ä—Ç–µ
- –ò—Å–ø–æ–ª—å–∑—É–π –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ volume –¥–ª—è –ª–æ–≥–æ–≤ –∏ –ë–î
- –†–∞–∑–¥–µ–ª—è–π –∫–æ–Ω—Ñ–∏–≥–∏ –ø–æ —Ä–æ–ª—è–º:
  - `configs/web1/`
  - `configs/web2/`
  - `configs/worker/`
  - `configs/common/`

---

## üöÄ –ü—Ä–∏–º–µ—Ä –∫–æ–º–∞–Ω–¥

```bash
# 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
docker compose -f docker-compose.init.yml up -d

# 2. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
docker compose -f docker-compose.init.yml down

# 3. –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞
docker compose up -d

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞
open http://localhost:81/spxml_web/main.htm
open http://localhost:82/spxml_web/main.htm

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker logs -f wt_web1
```

---

–ì–æ—Ç–æ–≤–æ ‚Äî —Ç–µ–ø–µ—Ä—å —É —Ç–µ–±—è —Ä–∞–±–æ—Ç–∞—é—â–µ–µ –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ WebSoft HCM ‚ú®

---

üß© –ü—Ä–æ—á–∏–µ —Å–µ—Ä–≤–∏—Å—ã (`Redis`, `PostgreSQL`, `Loki`, `Promtail`) –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å–µ—Ç—å `wt_net`.
–û—Ç–∫—Ä—ã—Ç–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –ø–æ—Ä—Ç–æ–≤ –¥–ª—è –Ω–∏—Ö –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è.